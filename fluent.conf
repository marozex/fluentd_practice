<source>
  @type tail
  path /fio/log/mysqld.slow.log
  pos_file /tmp/slowQuery.log.pos
  tag mysqld.slow
  @label @es
  read_from_head true
  <parse>
    @type multiline
    format_firstline /^# Time: /
    format1 /# Time: (?<end_time>.+)\n/
    format2 /# User@Host:\s+(?<user>.+)\[(?<current_user>.+)\]\s@\s\s\[+(?<ip>.+)\]\s\sId:\s+(?<thread_id>.+)/
    format3 /# Query_time:\s+(?<execution_time>.+)\s\s+Lock_time:\s+(?<lock_time>.+)\s+Rows_sent:\s+(?<rows_sent>.+)\s\sRows_examined:\s+(?<rows_examined>.+)/
    format4 /SET timestamp=(?<sql_timestamp>.+);/
    format5 /(?<query>.+)/
    types thread_id:integer, execution_time:float, lock_time:float, rows_sent:integer, rows_examined:integer, sql_timestamp:integer
  </parse>
</source>

# @label @es を受け取って標準出力に出す設定
<label @es>
  <filter **>
    @type record_transformer
    enable_ruby true
    <record>
      timestamp ${time.strftime('%Y-%m-%dT%H:%M:%S%z')}
      query ${record["query"]&.strip}
    </record>
  </filter>
  
  <match mysqld.slow>
    @type stdout
  </match>
</label>
